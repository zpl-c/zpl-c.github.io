<!DOCTYPE html><html lang="en"><head><script>
          (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
          new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
          j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
          'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
          })(window,document,'script','dataLayer','GTM-TVFMV4P');
        </script><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><link rel="apple-touch-icon" sizes="57x57" href="/favicon/apple-icon-57x57.png"/><link rel="apple-touch-icon" sizes="60x60" href="/favicon/apple-icon-60x60.png"/><link rel="apple-touch-icon" sizes="72x72" href="/favicon/apple-icon-72x72.png"/><link rel="apple-touch-icon" sizes="76x76" href="/favicon/apple-icon-76x76.png"/><link rel="apple-touch-icon" sizes="114x114" href="/favicon/apple-icon-114x114.png"/><link rel="apple-touch-icon" sizes="120x120" href="/favicon/apple-icon-120x120.png"/><link rel="apple-touch-icon" sizes="144x144" href="/favicon/apple-icon-144x144.png"/><link rel="apple-touch-icon" sizes="152x152" href="/favicon/apple-icon-152x152.png"/><link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-icon-180x180.png"/><link rel="icon" type="image/png" sizes="192x192" href="/favicon/android-icon-192x192.png"/><link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="96x96" href="/favicon/favicon-96x96.png"/><link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png"/><link rel="manifest" href="/favicon/manifest.json"/><meta name="msapplication-config" content="/favicon/browserconfig.xml"/><meta name="msapplication-TileColor" content="#000000"/><meta name="msapplication-TileImage" content="/favicon/ms-icon-144x144.png"/><meta name="theme-color" content="#0000"/><link rel="shortcut icon" href="/favicon/favicon.ico"/><link rel="alternate" type="application/rss+xml" href="/feed.xml"/><meta name="description" content="zpl.blog"/><meta property="og:image" content="https://og-image.now.sh/**zpl**%20blog.png?theme=dark&amp;md=1&amp;fontSize=125px&amp;images=https%3A%2F%2Fassets.vercel.com%2Fimage%2Fupload%2Ffront%2Fassets%2Fdesign%2Fhyper-bw-logo.svg&amp;widths=auto"/><title>ADT queries! | ZPL Blog</title><meta name="author" content="Dominik Madarász"/><meta property="og:image" content="https://og-image.now.sh/**zpl**%20blog.png?theme=dark&amp;md=1&amp;fontSize=125px&amp;images=https%3A%2F%2Fassets.vercel.com%2Fimage%2Fupload%2Ffront%2Fassets%2Fdesign%2Fhyper-bw-logo.svg&amp;widths=auto"/><meta property="og:type" content="article"/><meta property="article:published_time" content="2022-06-09T00:00:00.000Z"/><meta name="next-head-count" content="29"/><link rel="preload" href="/_next/static/css/5a759f8e0f487fff0c56.css" as="style"/><link rel="stylesheet" href="/_next/static/css/5a759f8e0f487fff0c56.css" data-n-g=""/><link rel="preload" href="/_next/static/css/a44c54513fc11368c904.css" as="style"/><link rel="stylesheet" href="/_next/static/css/a44c54513fc11368c904.css" data-n-p=""/><noscript data-n-css=""></noscript><link rel="preload" href="/_next/static/chunks/main-fdef83064900f96f4be8.js" as="script"/><link rel="preload" href="/_next/static/chunks/webpack-50bee04d1dc61f8adf5b.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework.9d524150d48315f49e80.js" as="script"/><link rel="preload" href="/_next/static/chunks/commons.fcb3af5b7dbe1123d751.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/_app-72a69d98524f5b33fa38.js" as="script"/><link rel="preload" href="/_next/static/chunks/2c3b9bffc7150b37a7b3810dfcf1c0b0fac2bd18.45aebcb94f5dbd290f7f.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/posts/%5Bslug%5D-e5701cdbb8ee77b5cb00.js" as="script"/></head><body><div id="__next"><div class="min-h-screen"><main><div class="container mx-auto px-5 max-w-screen-lg"><h2 class="text-2xl md:text-4xl font-bold tracking-tight md:tracking-tighter leading-tight mb-20 mt-8"><a class="hover:underline" href="/">zpl</a>.</h2><article class="mb-32"><h1 class="text-6xl md:text-7xl lg:text-8xl font-bold tracking-tighter leading-tight md:leading-none mb-12 text-center md:text-left">ADT queries!</h1><div class="hidden md:block md:mb-12"><div class="flex items-center"><img src="/assets/authors/dominik.jpg" class="w-12 h-12 rounded-full mr-4" alt="Dominik Madarász"/><div class="text-xl font-bold">Dominik Madarász</div></div></div><div class="max-w-2xl mx-auto"><div class="block md:hidden mb-6"><div class="flex items-center"><img src="/assets/authors/dominik.jpg" class="w-12 h-12 rounded-full mr-4" alt="Dominik Madarász"/><div class="text-xl font-bold">Dominik Madarász</div></div></div><div class="mb-6 text-lg"><time class="text-gray-500" dateTime="2022-06-09T00:00:00.000Z">June	9, 2022</time></div></div><div class="max-w-2xl mx-auto"><div class="markdown-styles_markdown__1x9gM"><p>Hi there!</p>
<p>With the release of <a href="https://github.com/zpl-c/zpl/releases/tag/16.1.1">16.1.1</a> version of zpl you are now able to perform URI like queries on ADT nodes.</p>
<p>The new function <code>zpl_adt_get</code> takes a URI which specifies how we should perform a lookup on an ADT node. The following features are present:</p>
<ul>
<li>nested lookup
<ul>
<li><code>a/b/c</code> would look through nodes to fetch the <code>c</code> node.</li>
</ul>
</li>
<li>nested conditional lookup
<ul>
<li><code>arr/[foo=123]/bar</code> would scan the <code>arr</code> array node to find an object element which field <code>foo</code> would be of value <code>123</code>, it would then fetch a node inside called <code>bar</code>.</li>
</ul>
</li>
<li>index-based lookup
<ul>
<li><code>arr/3</code> would fetch the 4th element of array node <code>arr</code>.</li>
</ul>
</li>
<li>value-based lookup
<ul>
<li><code>arr/[apple]</code> would fetch an element of array node <code>arr</code> with value <code>apple</code>.</li>
</ul>
</li>
</ul>
<p>The following code showcases this new feature:</p>
<pre><code class="language-c">#define ZPL_IMPLEMENTATION
#define ZPL_NANO
#define ZPL_ENABLE_PARSER
#include &#x3C;zpl.h>

int main(void) {
    zpl_file_contents fc;
    fc = zpl_file_read_contents(zpl_heap(), true, "misc/data/glsl_diffuse.json5");

    zpl_json_object root = {0};

    zpl_u8 err;
    err = zpl_json_parse(&#x26;root, (char *)fc.data, zpl_heap_allocator());
    zpl_printf("Error code: %d\n", err);

    zpl_json_object *nested_node_variant = zpl_adt_get(&#x26;root, "layer1/layer2/layer3");
    ZPL_ASSERT_NOT_NULL(nested_node_variant);
    ZPL_ASSERT(nested_node_variant->integer == 42);

    zpl_json_object *def_value_node = zpl_adt_get(&#x26;root, "uniforms/[name=distort]/layout/[pos=y]/default_value");
    ZPL_ASSERT_NOT_NULL(def_value_node);

    zpl_json_object *num_42_node = zpl_adt_get(&#x26;root, "numbers/[value=42]");
    ZPL_ASSERT_NOT_NULL(num_42_node);

    zpl_json_object *arr_idx_node = zpl_adt_get(&#x26;root, "array/3");
    ZPL_ASSERT_NOT_NULL(arr_idx_node);
    ZPL_ASSERT(arr_idx_node->integer == 4);

    zpl_json_object *arr_val_node = zpl_adt_get(&#x26;root, "array/[4]");
    ZPL_ASSERT_NOT_NULL(arr_val_node);

    zpl_json_free(&#x26;root);
    zpl_file_free_contents(&#x26;fc);
    return 0;
}
</code></pre>
<p>We also plan to implement a sscanf alike addition to this API later on, stay tuned!</p>
<p>See you next time!</p>
</div></div></article></div></main></div><footer class="bg-accent-1 border-t border-accent-2"><div class="container mx-auto px-5 max-w-screen-lg"><div class="py-28 flex flex-col lg:flex-row items-center"><h3 class="text-4xl lg:text-5xl font-bold tracking-tighter leading-tight text-center lg:text-left mb-10 lg:mb-0 lg:pr-4 lg:w-1/2">A collection of single-file header-only libararies for C and C++.</h3><div class="flex flex-col lg:flex-row justify-center items-center lg:pl-4 lg:w-1/2"><a href="https://zpl.pw/fetch" class="mx-3 bg-black hover:bg-white hover:text-black border border-black text-white font-bold py-3 px-12 lg:px-8 duration-200 transition-colors mb-6 lg:mb-0">Download latest release</a><a href="https://github.com/zpl-c" class="mx-3 font-bold hover:underline">View on GitHub</a></div></div></div></footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"title":"ADT queries!","date":"2022-06-09T00:00:00.000Z","slug":"2022-adt-queries","author":"zaklaus","content":"\u003cp\u003eHi there!\u003c/p\u003e\n\u003cp\u003eWith the release of \u003ca href=\"https://github.com/zpl-c/zpl/releases/tag/16.1.1\"\u003e16.1.1\u003c/a\u003e version of zpl you are now able to perform URI like queries on ADT nodes.\u003c/p\u003e\n\u003cp\u003eThe new function \u003ccode\u003ezpl_adt_get\u003c/code\u003e takes a URI which specifies how we should perform a lookup on an ADT node. The following features are present:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003enested lookup\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003ea/b/c\u003c/code\u003e would look through nodes to fetch the \u003ccode\u003ec\u003c/code\u003e node.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003enested conditional lookup\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003earr/[foo=123]/bar\u003c/code\u003e would scan the \u003ccode\u003earr\u003c/code\u003e array node to find an object element which field \u003ccode\u003efoo\u003c/code\u003e would be of value \u003ccode\u003e123\u003c/code\u003e, it would then fetch a node inside called \u003ccode\u003ebar\u003c/code\u003e.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eindex-based lookup\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003earr/3\u003c/code\u003e would fetch the 4th element of array node \u003ccode\u003earr\u003c/code\u003e.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003evalue-based lookup\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003earr/[apple]\u003c/code\u003e would fetch an element of array node \u003ccode\u003earr\u003c/code\u003e with value \u003ccode\u003eapple\u003c/code\u003e.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eThe following code showcases this new feature:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-c\"\u003e#define ZPL_IMPLEMENTATION\n#define ZPL_NANO\n#define ZPL_ENABLE_PARSER\n#include \u0026#x3C;zpl.h\u003e\n\nint main(void) {\n    zpl_file_contents fc;\n    fc = zpl_file_read_contents(zpl_heap(), true, \"misc/data/glsl_diffuse.json5\");\n\n    zpl_json_object root = {0};\n\n    zpl_u8 err;\n    err = zpl_json_parse(\u0026#x26;root, (char *)fc.data, zpl_heap_allocator());\n    zpl_printf(\"Error code: %d\\n\", err);\n\n    zpl_json_object *nested_node_variant = zpl_adt_get(\u0026#x26;root, \"layer1/layer2/layer3\");\n    ZPL_ASSERT_NOT_NULL(nested_node_variant);\n    ZPL_ASSERT(nested_node_variant-\u003einteger == 42);\n\n    zpl_json_object *def_value_node = zpl_adt_get(\u0026#x26;root, \"uniforms/[name=distort]/layout/[pos=y]/default_value\");\n    ZPL_ASSERT_NOT_NULL(def_value_node);\n\n    zpl_json_object *num_42_node = zpl_adt_get(\u0026#x26;root, \"numbers/[value=42]\");\n    ZPL_ASSERT_NOT_NULL(num_42_node);\n\n    zpl_json_object *arr_idx_node = zpl_adt_get(\u0026#x26;root, \"array/3\");\n    ZPL_ASSERT_NOT_NULL(arr_idx_node);\n    ZPL_ASSERT(arr_idx_node-\u003einteger == 4);\n\n    zpl_json_object *arr_val_node = zpl_adt_get(\u0026#x26;root, \"array/[4]\");\n    ZPL_ASSERT_NOT_NULL(arr_val_node);\n\n    zpl_json_free(\u0026#x26;root);\n    zpl_file_free_contents(\u0026#x26;fc);\n    return 0;\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eWe also plan to implement a sscanf alike addition to this API later on, stay tuned!\u003c/p\u003e\n\u003cp\u003eSee you next time!\u003c/p\u003e\n"}},"__N_SSG":true},"page":"/posts/[slug]","query":{"slug":"2022-adt-queries"},"buildId":"ZQEDZMOxBdKU87jDHjPEO","nextExport":false,"isFallback":false,"gsp":true}</script><script nomodule="" src="/_next/static/chunks/polyfills-8f31809deb7932dd0187.js"></script><script src="/_next/static/chunks/main-fdef83064900f96f4be8.js" async=""></script><script src="/_next/static/chunks/webpack-50bee04d1dc61f8adf5b.js" async=""></script><script src="/_next/static/chunks/framework.9d524150d48315f49e80.js" async=""></script><script src="/_next/static/chunks/commons.fcb3af5b7dbe1123d751.js" async=""></script><script src="/_next/static/chunks/pages/_app-72a69d98524f5b33fa38.js" async=""></script><script src="/_next/static/chunks/2c3b9bffc7150b37a7b3810dfcf1c0b0fac2bd18.45aebcb94f5dbd290f7f.js" async=""></script><script src="/_next/static/chunks/pages/posts/%5Bslug%5D-e5701cdbb8ee77b5cb00.js" async=""></script><script src="/_next/static/ZQEDZMOxBdKU87jDHjPEO/_buildManifest.js" async=""></script><script src="/_next/static/ZQEDZMOxBdKU87jDHjPEO/_ssgManifest.js" async=""></script></body></html>