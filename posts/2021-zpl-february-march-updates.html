<!DOCTYPE html><html lang="en"><head><script>
          (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
          new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
          j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
          'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
          })(window,document,'script','dataLayer','GTM-TVFMV4P');
        </script><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><link rel="apple-touch-icon" sizes="57x57" href="/favicon/apple-icon-57x57.png"/><link rel="apple-touch-icon" sizes="60x60" href="/favicon/apple-icon-60x60.png"/><link rel="apple-touch-icon" sizes="72x72" href="/favicon/apple-icon-72x72.png"/><link rel="apple-touch-icon" sizes="76x76" href="/favicon/apple-icon-76x76.png"/><link rel="apple-touch-icon" sizes="114x114" href="/favicon/apple-icon-114x114.png"/><link rel="apple-touch-icon" sizes="120x120" href="/favicon/apple-icon-120x120.png"/><link rel="apple-touch-icon" sizes="144x144" href="/favicon/apple-icon-144x144.png"/><link rel="apple-touch-icon" sizes="152x152" href="/favicon/apple-icon-152x152.png"/><link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-icon-180x180.png"/><link rel="icon" type="image/png" sizes="192x192" href="/favicon/android-icon-192x192.png"/><link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="96x96" href="/favicon/favicon-96x96.png"/><link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png"/><link rel="manifest" href="/favicon/manifest.json"/><meta name="msapplication-config" content="/favicon/browserconfig.xml"/><meta name="msapplication-TileColor" content="#000000"/><meta name="msapplication-TileImage" content="/favicon/ms-icon-144x144.png"/><meta name="theme-color" content="#0000"/><link rel="shortcut icon" href="/favicon/favicon.ico"/><link rel="alternate" type="application/rss+xml" href="/feed.xml"/><meta name="description" content="zpl.blog"/><meta property="og:image" content="https://avatars.githubusercontent.com/u/31039603?s=400&amp;u=371f601b81fd4c6843f910b4565a54704caaa374&amp;v=4"/><title>February/March 2021 library updates | zpl.blog</title><meta name="author" content="Dominik Madarász"/><meta property="og:image" content="https://avatars.githubusercontent.com/u/31039603?s=400&amp;u=371f601b81fd4c6843f910b4565a54704caaa374&amp;v=4"/><meta property="og:type" content="article"/><meta property="article:published_time" content="2021-02-21T00:00:00.000Z"/><meta name="next-head-count" content="29"/><link rel="preload" href="/_next/static/css/5a759f8e0f487fff0c56.css" as="style"/><link rel="stylesheet" href="/_next/static/css/5a759f8e0f487fff0c56.css" data-n-g=""/><link rel="preload" href="/_next/static/css/a44c54513fc11368c904.css" as="style"/><link rel="stylesheet" href="/_next/static/css/a44c54513fc11368c904.css" data-n-p=""/><noscript data-n-css=""></noscript><link rel="preload" href="/_next/static/chunks/main-fdef83064900f96f4be8.js" as="script"/><link rel="preload" href="/_next/static/chunks/webpack-50bee04d1dc61f8adf5b.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework.9d524150d48315f49e80.js" as="script"/><link rel="preload" href="/_next/static/chunks/commons.fcb3af5b7dbe1123d751.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/_app-72a69d98524f5b33fa38.js" as="script"/><link rel="preload" href="/_next/static/chunks/2c3b9bffc7150b37a7b3810dfcf1c0b0fac2bd18.9d4567a9d9c4e4003247.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/posts/%5Bslug%5D-e5701cdbb8ee77b5cb00.js" as="script"/></head><body><div id="__next"><div class="min-h-screen"><main><div class="container mx-auto px-5 max-w-screen-lg"><h2 class="text-2xl md:text-4xl font-bold tracking-tight md:tracking-tighter leading-tight mb-20 mt-8"><a class="hover:underline" href="/">zpl</a>.</h2><article class="mb-32"><h1 class="text-6xl md:text-7xl lg:text-8xl font-bold tracking-tighter leading-tight md:leading-none mb-12 text-center md:text-left">February/March 2021 library updates</h1><div class="hidden md:block md:mb-12"><div class="flex items-center"><img src="/assets/authors/dominik.jpg" class="w-12 h-12 rounded-full mr-4" alt="Dominik Madarász"/><div class="text-xl font-bold">Dominik Madarász</div></div></div><div class="max-w-2xl mx-auto"><div class="block md:hidden mb-6"><div class="flex items-center"><img src="/assets/authors/dominik.jpg" class="w-12 h-12 rounded-full mr-4" alt="Dominik Madarász"/><div class="text-xl font-bold">Dominik Madarász</div></div></div><div class="mb-6 text-lg"><time class="text-gray-500" dateTime="2021-02-21T00:00:00.000Z">February	21, 2021</time></div></div><div class="max-w-2xl mx-auto"><div class="markdown-styles_markdown__1x9gM"><p>Hey community!</p>
<p>Today we are going to talk about few new and upcoming features to the <strong>zpl</strong> library:</p>
<h2>TCC Compatibility</h2>
<p>Just a small heads up, the <a href="https://bellard.org/tcc/">https://bellard.org/tcc/</a> compiler is now partially compatible with <strong>zpl</strong>!</p>
<p>Threading code is currently disabled, as the compiler does not support C11 features. zpl_rdtsc also has a limited support when used on ARM family, as tcc does not support inline assembly on ARM.</p>
<h2>JSON Parser</h2>
<p>The zpl's json parser finally got some updates. It now introduces a new API to easily compose new JSON documents.</p>
<p>Original comment handling code was replaced in favor of much smaller and faster code and overall makes the parsing process very smooth.</p>
<p>Based on our tests on Raspberry Pi 4B, a <strong>55mb</strong> JSON file can be parsed in approx. <strong>650ms</strong> time on optimized builds, with comment handling routine enabled (takes around 1.3 seconds on unoptimized builds).</p>
<p>There's a plan to slowly rewrite and reduce the parser code to allow for more room for optimisations</p>
<p>On the other side, tests on Apple M1 Chip and the new parser implementation has mind-blowing speed! It parsed the same 55mb JSON file as above ^ <strong>within 100ms</strong> time on optimized build with comment handling routine enabled.</p>
<p>We don't know about you, but to us that sounds very fast! 🚀</p>
<p>Also just for reference the file in question can be accessed using <a href="https://www.reddit.com/r/datasets/comments/1uyd0t/200000_jeopardy_questions_in_a_json_file/">this link</a>.</p>
<h2>Upcoming version 12.0.0</h2>
<p>Quick update, ZPL 12.0.0 will be released soon and it contains a reworked JSON module, since today, comments are now handled internally as a part of the parsing process, this simplifies the API a lot as well.</p>
<p>Based on my tests on Raspberry Pi 4B, we were able to parse the same 55mb JSON file from above in ~550ms time. The code is also much smaller and easier to read, it finally goes along with the new design we've chosen for zpl itself.</p>
<p>More stats to come later! We could drop the time down to <strong>320ms</strong> by using a preallocated block of memory on Raspberry Pi 4B.</p>
<p>We ran the same test on AMD Ryzen 7 3700X capable machine, optimized build took 95ms to parse the same test file!</p>
</div></div></article></div></main></div><footer class="bg-accent-1 border-t border-accent-2"><div class="container mx-auto px-5 max-w-screen-lg"><div class="py-28 flex flex-col lg:flex-row items-center"><h3 class="text-4xl lg:text-5xl font-bold tracking-tighter leading-tight text-center lg:text-left mb-10 lg:mb-0 lg:pr-4 lg:w-1/2">A collection of single-file header-only libararies for C and C++.</h3><div class="flex flex-col lg:flex-row justify-center items-center lg:pl-4 lg:w-1/2"><a href="https://github.com/zpl-c/zpl/releases/latest/download/zpl.h" class="mx-3 bg-black hover:bg-white hover:text-black border border-black text-white font-bold py-3 px-12 lg:px-8 duration-200 transition-colors mb-6 lg:mb-0">Download latest release</a><a href="https://github.com/zpl-c" class="mx-3 font-bold hover:underline">View on GitHub</a></div></div></div></footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"title":"February/March 2021 library updates","date":"2021-02-21T00:00:00.000Z","slug":"2021-zpl-february-march-updates","author":"zaklaus","content":"\u003cp\u003eHey community!\u003c/p\u003e\n\u003cp\u003eToday we are going to talk about few new and upcoming features to the \u003cstrong\u003ezpl\u003c/strong\u003e library:\u003c/p\u003e\n\u003ch2\u003eTCC Compatibility\u003c/h2\u003e\n\u003cp\u003eJust a small heads up, the \u003ca href=\"https://bellard.org/tcc/\"\u003ehttps://bellard.org/tcc/\u003c/a\u003e compiler is now partially compatible with \u003cstrong\u003ezpl\u003c/strong\u003e!\u003c/p\u003e\n\u003cp\u003eThreading code is currently disabled, as the compiler does not support C11 features. zpl_rdtsc also has a limited support when used on ARM family, as tcc does not support inline assembly on ARM.\u003c/p\u003e\n\u003ch2\u003eJSON Parser\u003c/h2\u003e\n\u003cp\u003eThe zpl's json parser finally got some updates. It now introduces a new API to easily compose new JSON documents.\u003c/p\u003e\n\u003cp\u003eOriginal comment handling code was replaced in favor of much smaller and faster code and overall makes the parsing process very smooth.\u003c/p\u003e\n\u003cp\u003eBased on our tests on Raspberry Pi 4B, a \u003cstrong\u003e55mb\u003c/strong\u003e JSON file can be parsed in approx. \u003cstrong\u003e650ms\u003c/strong\u003e time on optimized builds, with comment handling routine enabled (takes around 1.3 seconds on unoptimized builds).\u003c/p\u003e\n\u003cp\u003eThere's a plan to slowly rewrite and reduce the parser code to allow for more room for optimisations\u003c/p\u003e\n\u003cp\u003eOn the other side, tests on Apple M1 Chip and the new parser implementation has mind-blowing speed! It parsed the same 55mb JSON file as above ^ \u003cstrong\u003ewithin 100ms\u003c/strong\u003e time on optimized build with comment handling routine enabled.\u003c/p\u003e\n\u003cp\u003eWe don't know about you, but to us that sounds very fast! 🚀\u003c/p\u003e\n\u003cp\u003eAlso just for reference the file in question can be accessed using \u003ca href=\"https://www.reddit.com/r/datasets/comments/1uyd0t/200000_jeopardy_questions_in_a_json_file/\"\u003ethis link\u003c/a\u003e.\u003c/p\u003e\n\u003ch2\u003eUpcoming version 12.0.0\u003c/h2\u003e\n\u003cp\u003eQuick update, ZPL 12.0.0 will be released soon and it contains a reworked JSON module, since today, comments are now handled internally as a part of the parsing process, this simplifies the API a lot as well.\u003c/p\u003e\n\u003cp\u003eBased on my tests on Raspberry Pi 4B, we were able to parse the same 55mb JSON file from above in ~550ms time. The code is also much smaller and easier to read, it finally goes along with the new design we've chosen for zpl itself.\u003c/p\u003e\n\u003cp\u003eMore stats to come later! We could drop the time down to \u003cstrong\u003e320ms\u003c/strong\u003e by using a preallocated block of memory on Raspberry Pi 4B.\u003c/p\u003e\n\u003cp\u003eWe ran the same test on AMD Ryzen 7 3700X capable machine, optimized build took 95ms to parse the same test file!\u003c/p\u003e\n"}},"__N_SSG":true},"page":"/posts/[slug]","query":{"slug":"2021-zpl-february-march-updates"},"buildId":"eq0BXQcweAaXDl-wJKjoa","nextExport":false,"isFallback":false,"gsp":true}</script><script nomodule="" src="/_next/static/chunks/polyfills-8f31809deb7932dd0187.js"></script><script src="/_next/static/chunks/main-fdef83064900f96f4be8.js" async=""></script><script src="/_next/static/chunks/webpack-50bee04d1dc61f8adf5b.js" async=""></script><script src="/_next/static/chunks/framework.9d524150d48315f49e80.js" async=""></script><script src="/_next/static/chunks/commons.fcb3af5b7dbe1123d751.js" async=""></script><script src="/_next/static/chunks/pages/_app-72a69d98524f5b33fa38.js" async=""></script><script src="/_next/static/chunks/2c3b9bffc7150b37a7b3810dfcf1c0b0fac2bd18.9d4567a9d9c4e4003247.js" async=""></script><script src="/_next/static/chunks/pages/posts/%5Bslug%5D-e5701cdbb8ee77b5cb00.js" async=""></script><script src="/_next/static/eq0BXQcweAaXDl-wJKjoa/_buildManifest.js" async=""></script><script src="/_next/static/eq0BXQcweAaXDl-wJKjoa/_ssgManifest.js" async=""></script></body></html>