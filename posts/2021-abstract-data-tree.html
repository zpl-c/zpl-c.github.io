<!DOCTYPE html><html lang="en"><head><script>
          (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
          new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
          j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
          'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
          })(window,document,'script','dataLayer','GTM-TVFMV4P');
        </script><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><link rel="apple-touch-icon" sizes="57x57" href="/favicon/apple-icon-57x57.png"/><link rel="apple-touch-icon" sizes="60x60" href="/favicon/apple-icon-60x60.png"/><link rel="apple-touch-icon" sizes="72x72" href="/favicon/apple-icon-72x72.png"/><link rel="apple-touch-icon" sizes="76x76" href="/favicon/apple-icon-76x76.png"/><link rel="apple-touch-icon" sizes="114x114" href="/favicon/apple-icon-114x114.png"/><link rel="apple-touch-icon" sizes="120x120" href="/favicon/apple-icon-120x120.png"/><link rel="apple-touch-icon" sizes="144x144" href="/favicon/apple-icon-144x144.png"/><link rel="apple-touch-icon" sizes="152x152" href="/favicon/apple-icon-152x152.png"/><link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-icon-180x180.png"/><link rel="icon" type="image/png" sizes="192x192" href="/favicon/android-icon-192x192.png"/><link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="96x96" href="/favicon/favicon-96x96.png"/><link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png"/><link rel="manifest" href="/favicon/manifest.json"/><meta name="msapplication-config" content="/favicon/browserconfig.xml"/><meta name="msapplication-TileColor" content="#000000"/><meta name="msapplication-TileImage" content="/favicon/ms-icon-144x144.png"/><meta name="theme-color" content="#0000"/><link rel="shortcut icon" href="/favicon/favicon.ico"/><link rel="alternate" type="application/rss+xml" href="/feed.xml"/><meta name="description" content="zpl.blog"/><meta property="og:image" content="https://og-image.now.sh/**zpl**%20blog.png?theme=dark&amp;md=1&amp;fontSize=125px&amp;images=https%3A%2F%2Fassets.vercel.com%2Fimage%2Fupload%2Ffront%2Fassets%2Fdesign%2Fhyper-bw-logo.svg&amp;widths=auto"/><title>Abstract Data Tree | ZPL Blog</title><meta name="author" content="Dominik Madarász"/><meta property="og:image" content="https://og-image.now.sh/**zpl**%20blog.png?theme=dark&amp;md=1&amp;fontSize=125px&amp;images=https%3A%2F%2Fassets.vercel.com%2Fimage%2Fupload%2Ffront%2Fassets%2Fdesign%2Fhyper-bw-logo.svg&amp;widths=auto"/><meta property="og:type" content="article"/><meta property="article:published_time" content="2021-04-22T17:54:00.000Z"/><meta name="next-head-count" content="29"/><link rel="preload" href="/_next/static/css/5a759f8e0f487fff0c56.css" as="style"/><link rel="stylesheet" href="/_next/static/css/5a759f8e0f487fff0c56.css" data-n-g=""/><link rel="preload" href="/_next/static/css/a44c54513fc11368c904.css" as="style"/><link rel="stylesheet" href="/_next/static/css/a44c54513fc11368c904.css" data-n-p=""/><noscript data-n-css=""></noscript><link rel="preload" href="/_next/static/chunks/main-fdef83064900f96f4be8.js" as="script"/><link rel="preload" href="/_next/static/chunks/webpack-50bee04d1dc61f8adf5b.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework.9d524150d48315f49e80.js" as="script"/><link rel="preload" href="/_next/static/chunks/commons.fcb3af5b7dbe1123d751.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/_app-72a69d98524f5b33fa38.js" as="script"/><link rel="preload" href="/_next/static/chunks/2c3b9bffc7150b37a7b3810dfcf1c0b0fac2bd18.45aebcb94f5dbd290f7f.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/posts/%5Bslug%5D-e5701cdbb8ee77b5cb00.js" as="script"/></head><body><div id="__next"><div class="min-h-screen"><main><div class="container mx-auto px-5 max-w-screen-lg"><h2 class="text-2xl md:text-4xl font-bold tracking-tight md:tracking-tighter leading-tight mb-20 mt-8"><a class="hover:underline" href="/">zpl</a>.</h2><article class="mb-32"><h1 class="text-6xl md:text-7xl lg:text-8xl font-bold tracking-tighter leading-tight md:leading-none mb-12 text-center md:text-left">Abstract Data Tree</h1><div class="hidden md:block md:mb-12"><div class="flex items-center"><img src="/assets/authors/dominik.jpg" class="w-12 h-12 rounded-full mr-4" alt="Dominik Madarász"/><div class="text-xl font-bold">Dominik Madarász</div></div></div><div class="max-w-2xl mx-auto"><div class="block md:hidden mb-6"><div class="flex items-center"><img src="/assets/authors/dominik.jpg" class="w-12 h-12 rounded-full mr-4" alt="Dominik Madarász"/><div class="text-xl font-bold">Dominik Madarász</div></div></div><div class="mb-6 text-lg"><time class="text-gray-500" dateTime="2021-04-22T17:54:00.000Z">April	22, 2021</time></div></div><div class="max-w-2xl mx-auto"><div class="markdown-styles_markdown__1x9gM"><p>The <strong>13.1.0</strong> release of <a href="http://zpl.pw">zpl</a> has arrived and we have some news to share!
We have primarily focused on rewriting our JSON5 module, which allows us to integrate new parsers more easily! Let's get into major changes:</p>
<h2>The manual builder</h2>
<p>ADT builder allows us to construct data structure trees that are format-agnostic and flexible. <code>zpl_adt_node</code> contains enough information to cover all parser needs, ensuring that we can export this data into any format zpl supports.</p>
<p>We have also developed a few helper methods to make data layout design easier to work with, namely:</p>
<ul>
<li><code>zpl_adt_inset(parent, name, value)</code> that appends a new node into provided <code>parent</code> branch,</li>
<li>or <code>zpl_adt_set(node, name, value)</code> that sets up our existing node with a value.</li>
</ul>
<p>We have extracted a few methods from the former JSON5 parser as well:</p>
<ul>
<li><code>zpl_adt_parse_number(node, text)</code> parses the text and populates the node with a full number analysis,</li>
<li>and <code>zpl_adt_str_to_flt(node)</code> that does the same thing, but relies on existing <em>string</em> node data to analyze the number.</li>
</ul>
<h2>JSON5/SJSON parser</h2>
<p>The primary reason behind the JSON5 refactor was to reduce code complexity and put reusable components into a shared module all parsers would benefit from.</p>
<p>We have reworked the parser from the ground up to benefit from the new ADT builder API. The code has been reduced substantially, and it is much easier to follow the flow now.</p>
<p>The constant data type has also been removed in favor of number-based constant values we've already used for <code>Infinity</code> or <code>NaN</code>.</p>
<h2>CSV parser</h2>
<p>A new addition to the parser (now a) family is the CSV support! It follows the <code>RFC 4180</code> standard and supports various commonly used features, such as string literals, headers, or custom delimiters.</p>
<p>The data layout in ADT is simple. Per each column, we create an array node holding cells of a respective row. The following CSV data:</p>
<pre><code class="language-csv">foo, bar, baz
1,   2,   3
4,   5,   6
</code></pre>
<p>will be represented in memory as:</p>
<pre><code class="language-jsx">root = {
  foo = [1, 4],
  bar = [2, 5],
  baz = [3, 6]
}
</code></pre>
<p>or, if we import a header-less CSV collection, it would be an array of arrays:</p>
<pre><code class="language-jsx">root = [
  [1, 4],
  [2, 5],
  [3, 6]
]
</code></pre>
<h3>String literals</h3>
<p>The CSV parser also supports string literals with escaped double-quotes. The following CSV data is valid:</p>
<pre><code class="language-csv">name, occupation
Jim Halpert, Salesman
"Michael Scott", Regional Manager
"Dwight ""Danger?"" Schrute", "Assistant (to the) Regional Manager"
</code></pre>
<p>The list of names would be populated as follows: <code>Jim Halpert</code>, <code>Michael Scott</code>, <code>Dwight "Danger?" Schrute</code>.</p>
<h2>Build once, transform anywhere!</h2>
<p>We can build our own data tree with the features above and export it to any format we desire (as long as zpl supports it).</p>
<p>Say we import the CSV collection from above:</p>
<pre><code class="language-csv">foo, bar, baz
1,   2,   3
4,   5,   6
</code></pre>
<p>The same data can be directly exported into JSON5:</p>
<pre><code class="language-json">{
  "foo": [1, 4],
  "bar": [2, 5],
  "baz": [3, 6]
}
</code></pre>
<p>and vice versa!</p>
<p>This opens up a lot of opportunities, like building custom native low-level data pipelines for ETL and transformations.</p>
<h2>Plans</h2>
<p>We plan to add support for more languages over time. The <strong>YAML</strong> and <strong>TOML</strong> languages are the ones we will focus on shortly. However, we're open to any suggestions or contributions to enhance our little parser library.</p>
<p>Thanks for reading!</p>
</div></div></article></div></main></div><footer class="bg-accent-1 border-t border-accent-2"><div class="container mx-auto px-5 max-w-screen-lg"><div class="py-28 flex flex-col lg:flex-row items-center"><h3 class="text-4xl lg:text-5xl font-bold tracking-tighter leading-tight text-center lg:text-left mb-10 lg:mb-0 lg:pr-4 lg:w-1/2">A collection of single-file header-only libararies for C and C++.</h3><div class="flex flex-col lg:flex-row justify-center items-center lg:pl-4 lg:w-1/2"><a href="https://zpl.pw/fetch" class="mx-3 bg-black hover:bg-white hover:text-black border border-black text-white font-bold py-3 px-12 lg:px-8 duration-200 transition-colors mb-6 lg:mb-0">Download latest release</a><a href="https://github.com/zpl-c" class="mx-3 font-bold hover:underline">View on GitHub</a></div></div></div></footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"title":"Abstract Data Tree","date":"2021-04-22T17:54:00.000Z","slug":"2021-abstract-data-tree","author":"zaklaus","content":"\u003cp\u003eThe \u003cstrong\u003e13.1.0\u003c/strong\u003e release of \u003ca href=\"http://zpl.pw\"\u003ezpl\u003c/a\u003e has arrived and we have some news to share!\nWe have primarily focused on rewriting our JSON5 module, which allows us to integrate new parsers more easily! Let's get into major changes:\u003c/p\u003e\n\u003ch2\u003eThe manual builder\u003c/h2\u003e\n\u003cp\u003eADT builder allows us to construct data structure trees that are format-agnostic and flexible. \u003ccode\u003ezpl_adt_node\u003c/code\u003e contains enough information to cover all parser needs, ensuring that we can export this data into any format zpl supports.\u003c/p\u003e\n\u003cp\u003eWe have also developed a few helper methods to make data layout design easier to work with, namely:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003ezpl_adt_inset(parent, name, value)\u003c/code\u003e that appends a new node into provided \u003ccode\u003eparent\u003c/code\u003e branch,\u003c/li\u003e\n\u003cli\u003eor \u003ccode\u003ezpl_adt_set(node, name, value)\u003c/code\u003e that sets up our existing node with a value.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eWe have extracted a few methods from the former JSON5 parser as well:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003ezpl_adt_parse_number(node, text)\u003c/code\u003e parses the text and populates the node with a full number analysis,\u003c/li\u003e\n\u003cli\u003eand \u003ccode\u003ezpl_adt_str_to_flt(node)\u003c/code\u003e that does the same thing, but relies on existing \u003cem\u003estring\u003c/em\u003e node data to analyze the number.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2\u003eJSON5/SJSON parser\u003c/h2\u003e\n\u003cp\u003eThe primary reason behind the JSON5 refactor was to reduce code complexity and put reusable components into a shared module all parsers would benefit from.\u003c/p\u003e\n\u003cp\u003eWe have reworked the parser from the ground up to benefit from the new ADT builder API. The code has been reduced substantially, and it is much easier to follow the flow now.\u003c/p\u003e\n\u003cp\u003eThe constant data type has also been removed in favor of number-based constant values we've already used for \u003ccode\u003eInfinity\u003c/code\u003e or \u003ccode\u003eNaN\u003c/code\u003e.\u003c/p\u003e\n\u003ch2\u003eCSV parser\u003c/h2\u003e\n\u003cp\u003eA new addition to the parser (now a) family is the CSV support! It follows the \u003ccode\u003eRFC 4180\u003c/code\u003e standard and supports various commonly used features, such as string literals, headers, or custom delimiters.\u003c/p\u003e\n\u003cp\u003eThe data layout in ADT is simple. Per each column, we create an array node holding cells of a respective row. The following CSV data:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-csv\"\u003efoo, bar, baz\n1,   2,   3\n4,   5,   6\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003ewill be represented in memory as:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-jsx\"\u003eroot = {\n  foo = [1, 4],\n  bar = [2, 5],\n  baz = [3, 6]\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eor, if we import a header-less CSV collection, it would be an array of arrays:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-jsx\"\u003eroot = [\n  [1, 4],\n  [2, 5],\n  [3, 6]\n]\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003eString literals\u003c/h3\u003e\n\u003cp\u003eThe CSV parser also supports string literals with escaped double-quotes. The following CSV data is valid:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-csv\"\u003ename, occupation\nJim Halpert, Salesman\n\"Michael Scott\", Regional Manager\n\"Dwight \"\"Danger?\"\" Schrute\", \"Assistant (to the) Regional Manager\"\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThe list of names would be populated as follows: \u003ccode\u003eJim Halpert\u003c/code\u003e, \u003ccode\u003eMichael Scott\u003c/code\u003e, \u003ccode\u003eDwight \"Danger?\" Schrute\u003c/code\u003e.\u003c/p\u003e\n\u003ch2\u003eBuild once, transform anywhere!\u003c/h2\u003e\n\u003cp\u003eWe can build our own data tree with the features above and export it to any format we desire (as long as zpl supports it).\u003c/p\u003e\n\u003cp\u003eSay we import the CSV collection from above:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-csv\"\u003efoo, bar, baz\n1,   2,   3\n4,   5,   6\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThe same data can be directly exported into JSON5:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-json\"\u003e{\n  \"foo\": [1, 4],\n  \"bar\": [2, 5],\n  \"baz\": [3, 6]\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eand vice versa!\u003c/p\u003e\n\u003cp\u003eThis opens up a lot of opportunities, like building custom native low-level data pipelines for ETL and transformations.\u003c/p\u003e\n\u003ch2\u003ePlans\u003c/h2\u003e\n\u003cp\u003eWe plan to add support for more languages over time. The \u003cstrong\u003eYAML\u003c/strong\u003e and \u003cstrong\u003eTOML\u003c/strong\u003e languages are the ones we will focus on shortly. However, we're open to any suggestions or contributions to enhance our little parser library.\u003c/p\u003e\n\u003cp\u003eThanks for reading!\u003c/p\u003e\n"}},"__N_SSG":true},"page":"/posts/[slug]","query":{"slug":"2021-abstract-data-tree"},"buildId":"Xsay7tKayjeWeJQwlXVoB","nextExport":false,"isFallback":false,"gsp":true}</script><script nomodule="" src="/_next/static/chunks/polyfills-8f31809deb7932dd0187.js"></script><script src="/_next/static/chunks/main-fdef83064900f96f4be8.js" async=""></script><script src="/_next/static/chunks/webpack-50bee04d1dc61f8adf5b.js" async=""></script><script src="/_next/static/chunks/framework.9d524150d48315f49e80.js" async=""></script><script src="/_next/static/chunks/commons.fcb3af5b7dbe1123d751.js" async=""></script><script src="/_next/static/chunks/pages/_app-72a69d98524f5b33fa38.js" async=""></script><script src="/_next/static/chunks/2c3b9bffc7150b37a7b3810dfcf1c0b0fac2bd18.45aebcb94f5dbd290f7f.js" async=""></script><script src="/_next/static/chunks/pages/posts/%5Bslug%5D-e5701cdbb8ee77b5cb00.js" async=""></script><script src="/_next/static/Xsay7tKayjeWeJQwlXVoB/_buildManifest.js" async=""></script><script src="/_next/static/Xsay7tKayjeWeJQwlXVoB/_ssgManifest.js" async=""></script></body></html>